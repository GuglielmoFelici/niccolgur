<ng-container *ngIf="!user">
    <p>Caricamento...</p>
</ng-container>
<ng-container *ngIf="user">
    <app-user-header [user]="user"></app-user-header>
    <mat-tab-group>
        <mat-tab>
            <ng-template mat-tab-label>Vota</ng-template>
            <div>
                <mat-form-field class="grouping-select">
                    <mat-select placeholder="Cerca per season" [value]="'asdasd'">
                        <mat-option *ngFor="let grouping of groupings"
                                    [value]="grouping.id"
                                    (onSelectionChange)="groupingChange($event, grouping.id)">
                            {{grouping.name}}
                        </mat-option>
                    </mat-select>
                </mat-form-field>

                <mat-form-field class="season-select" *ngIf="selectedGrouping === 0">
                    <mat-select [placeholder]="selectedSeason" [value]="selectedSeason || ''">
                        <mat-option *ngFor="let season of seasons"
                                    [value]="season + 1"
                                    (onSelectionChange)="seasonChange(season + 1)">
                            Season {{season + 1}}
                        </mat-option>
                    </mat-select>
                </mat-form-field>
                <mat-form-field class="master-select" *ngIf="selectedGrouping === 1">
                    <mat-select [placeholder]="selectedMaster.nickname" [value]="'asdasd'">
                        <mat-option *ngFor="let master of masters"
                                    [value]="master.id"
                                    (onSelectionChange)="masterChange(master)">
                            {{master.nickname}}
                        </mat-option>
                    </mat-select>
                </mat-form-field>
            </div>
            <div *ngIf="selectedGrouping === 2">
                <input type="text" placeholder="Inizia a digitare...">
            </div>

            <app-niccuscar-movie-card *ngFor="let niccolgur of niccolgurs" [niccolgur]="niccolgur"
                                      [votes]="votes"
                                      (votesChange)="votesChange($event)"
            ></app-niccuscar-movie-card>

        </mat-tab>
        <mat-tab>
            <ng-template mat-tab-label>Recap</ng-template>


            <!--            VOTI TOP 5-->

            <ng-container *ngFor="let vote of votesAsArray('TOP5')">
                <h3>{{vote.name}}</h3>
                <mat-table *ngIf="vote.type === 'TOP5'" [dataSource]="[1,2,3,4,5]">
                    <ng-container matColumnDef="position">
                        <mat-header-cell *matHeaderCellDef></mat-header-cell>
                        <mat-cell *matCellDef="let position">#{{position}} </mat-cell>
                    </ng-container>
                    <ng-container matColumnDef="votedMovie">
                        <mat-header-cell *matHeaderCellDef></mat-header-cell>
                        <mat-cell *matCellDef="let position"> {{vote[position - 1]?.movie_data?.title || '-'}} </mat-cell>
                    </ng-container>
                    <ng-container matColumnDef="controls">
                        <mat-header-cell *matHeaderCellDef></mat-header-cell>
                        <mat-cell *matCellDef="let position">
                            <ng-container *ngIf="vote[position-1]">
                                <mat-icon class="icon" [ngClass]="['icon', position===1 ? 'disabled' : '']">
                                    arrow_upward
                                </mat-icon>
                                <mat-icon></mat-icon>
                                <mat-icon class="icon" [ngClass]="['icon', position===5 ? 'disabled' : '']">
                                    arrow_downward
                                </mat-icon>
                                <mat-icon></mat-icon>
                                <mat-icon class="icon trash-icon">delete</mat-icon>
                            </ng-container>
                        </mat-cell>
                    </ng-container>
                    <mat-header-row *matHeaderRowDef="['position', 'votedMovie', 'controls']"></mat-header-row>
                    <mat-row *matRowDef="let myRowData; columns: ['position', 'votedMovie', 'controls']"></mat-row>


                </mat-table>
            </ng-container>


            <!--            VOTI PER MASTER-->

            <ng-container *ngFor="let vote of votesAsArray('MASTER')">
                <h3>{{vote.name}}</h3>
                <mat-table *ngIf="vote.type === 'MASTER'" [dataSource]="masters">
                    <ng-container matColumnDef="master">
                        <mat-header-cell *matHeaderCellDef></mat-header-cell>
                        <mat-cell *matCellDef="let master">{{master.nickname}} </mat-cell>
                    </ng-container>
                    <ng-container matColumnDef="votedMovie">
                        <mat-header-cell *matHeaderCellDef></mat-header-cell>
                        <mat-cell *matCellDef="let master"> {{vote.masterValues[master.id]?.movie_data?.title || '-'}} </mat-cell>
                    </ng-container>
                    <ng-container matColumnDef="controls">
                        <mat-header-cell *matHeaderCellDef></mat-header-cell>
                        <mat-cell *matCellDef="let master">
                            <mat-icon class="icon trash-icon" *ngIf="vote.masterValues[master.id]">delete</mat-icon>
                        </mat-cell>
                    </ng-container>
                    <mat-header-row *matHeaderRowDef="['master', 'votedMovie', 'controls']"></mat-header-row>
                    <mat-row *matRowDef="let myRowData; columns: ['master', 'votedMovie', 'controls']"></mat-row>
                </mat-table>
            </ng-container>

            <!--            VOTI BINARI-->

            <h3>Altre categorie</h3>
            <mat-table [dataSource]="votesAsArray('BINARY')">
                <ng-container matColumnDef="voteName">
                    <mat-header-cell *matHeaderCellDef></mat-header-cell>
                    <mat-cell *matCellDef="let vote">{{vote.name}} </mat-cell>
                </ng-container>
                <ng-container matColumnDef="votedMovie">
                    <mat-header-cell *matHeaderCellDef></mat-header-cell>
                    <mat-cell *matCellDef="let vote"> {{vote.values[0]?.movie_data?.title || '-'}} </mat-cell>
                </ng-container>
                <ng-container matColumnDef="controls">
                    <mat-header-cell *matHeaderCellDef></mat-header-cell>
                    <mat-cell *matCellDef="let vote">
                        <mat-icon class="icon trash-icon" *ngIf="vote.values[0]">delete</mat-icon>
                    </mat-cell>
                </ng-container>
                <mat-header-row *matHeaderRowDef="['voteName', 'votedMovie', 'controls']"></mat-header-row>
                <mat-row *matRowDef="let myRowData; columns: ['voteName', 'votedMovie', 'controls']"></mat-row>
            </mat-table>


        </mat-tab>
    </mat-tab-group>
</ng-container>
